<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Museum X - 交互增强版原型</title>
  <style>
    *{box-sizing:border-box}
    :root{
      --bg:#f5f6f7;
      --panel:#ffffff;
      --text:#222;
      --muted:#666;
      --muted2:#999;
      --border:#e9e9e9;
      --border2:#f0f0f0;
      --primary:#1677ff;
      --primary2:#0f5bd6;
      --warn:#ff9c00;
      --ok:#12b76a;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --shadow2: 0 6px 18px rgba(0,0,0,.10);
      --radius: 10px;
      --radius2: 12px;
      --focus: 0 0 0 3px rgba(22,119,255,.2);
    }
    [data-theme="dark"]{
      --bg:#0b0f14;
      --panel:#111827;
      --text:#e5e7eb;
      --muted:#b0b7c3;
      --muted2:#98a2b3;
      --border:#1f2937;
      --border2:#1f2937;
      --primary:#60a5fa;
      --primary2:#3b82f6;
      --warn:#fbbf24;
      --ok:#34d399;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --shadow2: 0 6px 18px rgba(0,0,0,.40);
      --focus: 0 0 0 3px rgba(96,165,250,.25);
    }

    html,body{height:100%}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;
      background:var(--bg);
      color:var(--text);
      overflow-x:hidden;
    }
    a{color:var(--primary);text-decoration:none;cursor:pointer}
    a:hover{text-decoration:underline}
    :focus-visible{outline:none; box-shadow: var(--focus); border-radius: 6px}

    /* 顶部栏 */
    header{
      position:sticky;top:0;z-index:50;
      background:color-mix(in oklab, var(--panel) 92%, transparent);
      backdrop-filter: blur(10px);
      padding:10px 22px;
      border-bottom:1px solid var(--border);
      display:flex;align-items:center;gap:14px;
    }
    .logo{font-size:18px;font-weight:800;color:var(--text);letter-spacing:.2px;user-select:none}
    .logo span{color:#ff6a00}
    .top-search{flex:1;display:flex;gap:10px;min-width:240px;position:relative}
    .top-search select,.top-search input{
      padding:10px 12px;border-radius:10px;border:1px solid var(--border);
      font-size:14px;background:var(--panel);color:var(--text);
    }
    .top-search input{flex:1}
    .top-search .suggest{
      position:absolute; left:0; right:0; top:46px;
      background:var(--panel); border:1px solid var(--border);
      border-radius:12px; box-shadow: var(--shadow2);
      overflow:hidden; display:none;
    }
    .top-search .suggest.open{display:block; animation: pop .14s ease-out}
    .suggest .item{
      padding:10px 12px; font-size:13px; color:var(--text);
      display:flex; justify-content:space-between; gap:10px;
      cursor:pointer;
    }
    .suggest .item:hover{background:color-mix(in oklab, var(--primary) 10%, var(--panel))}
    .suggest .type{font-size:12px;color:var(--muted2)}
    @keyframes pop{from{opacity:0; transform:translateY(-4px)}to{opacity:1; transform:translateY(0)}}

    .top-nav{display:flex;gap:14px;font-size:13px;white-space:nowrap}
    .top-nav a{color:color-mix(in oklab, var(--text) 78%, var(--muted))}
    .top-nav a.active{color:var(--primary);font-weight:700}

    .right-actions{display:flex;gap:10px;align-items:center}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:9px 12px;border-radius:10px;border:1px solid var(--primary);
      background:var(--primary);color:#fff;font-size:13px;cursor:pointer;
      transition: transform .12s ease, filter .12s ease, background .12s ease;
      user-select:none;
    }
    .btn:hover{filter:brightness(1.03)}
    .btn:active{transform: translateY(1px) scale(.99)}
    .btn-outline{background:transparent;color:var(--primary);border:1px solid color-mix(in oklab, var(--primary) 70%, var(--border))}
    .btn-ghost{background:transparent;border:1px solid var(--border);color:var(--text)}
    .btn-small{padding:7px 10px;border-radius:10px;font-size:12px}
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px;border-radius:999px;border:1px solid var(--border);
      background:var(--panel); color:var(--text); font-size:12px;
      cursor:pointer; user-select:none;
      transition: transform .12s ease, background .12s ease;
    }
    .chip:hover{background:color-mix(in oklab, var(--primary) 10%, var(--panel))}
    .chip:active{transform: translateY(1px)}
    .kbd{
      font-size:11px;color:var(--muted2);
      border:1px solid var(--border); border-bottom-color: color-mix(in oklab, var(--border) 60%, #000);
      padding:2px 6px; border-radius:6px; background:color-mix(in oklab, var(--panel) 80%, transparent);
    }

    /* 主体 */
    main#app{max-width:1120px;margin:18px auto 40px;padding:0 18px}
    .page{display:none;margin-bottom:40px;animation:fadeIn .18s ease-out}
    .page.active{display:block}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

    section{
      background:var(--panel);
      margin-bottom:16px;
      padding:16px 18px 18px;
      border-radius: var(--radius);
      border:1px solid var(--border2);
      box-shadow: 0 1px 0 rgba(0,0,0,.02);
    }
    section h2{margin:0 0 10px;font-size:18px}
    section h3{margin:0 0 10px;font-size:16px}
    .sub-title{color:var(--muted2);font-size:12px;margin-bottom:10px}

    .home-layout{display:flex;gap:16px;align-items:flex-start}
    .main-left{flex:3}
    .main-right{flex:1.25; position:sticky; top:74px}
    @media (max-width: 980px){
      header{flex-wrap:wrap}
      .top-nav{order:3; width:100%; overflow:auto; padding-bottom:6px}
      .main-right{position:static}
      .home-layout{flex-direction:column}
    }

    /* 卡片 */
    .card-list{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media (max-width: 720px){.card-list{grid-template-columns:1fr}}
    .card{
      border:1px solid var(--border2);
      border-radius: 12px;
      padding:12px;
      background:color-mix(in oklab, var(--panel) 88%, #fff);
      transition: transform .14s ease, box-shadow .14s ease, border-color .14s ease;
      position:relative;
      overflow:hidden;
    }
    [data-theme="dark"] .card{background:color-mix(in oklab, var(--panel) 92%, #000)}
    .card:hover{transform: translateY(-2px); box-shadow: var(--shadow2); border-color: color-mix(in oklab, var(--primary) 25%, var(--border2))}
    .card::after{
      content:"";
      position:absolute; inset:-80px -120px auto auto;
      width:180px; height:180px;
      background: radial-gradient(circle at 30% 30%, color-mix(in oklab, var(--primary) 35%, transparent), transparent 60%);
      transform: rotate(18deg);
      opacity:.9;
      pointer-events:none;
    }
    .card-title{font-size:14px;font-weight:750;margin-bottom:6px;line-height:1.35}
    .card-subtitle{font-size:12px;color:var(--muted);margin-bottom:6px}
    .rating{font-size:12px;color:var(--warn);margin-right:6px;font-weight:650}
    .meta{font-size:11px;color:var(--muted2)}
    .tag-row{font-size:11px;color:var(--muted2);margin-top:8px;display:flex;flex-wrap:wrap;gap:6px}
    .tag{
      display:inline-block;padding:2px 8px;border-radius:999px;
      border:1px solid var(--border);
      background:color-mix(in oklab, var(--panel) 85%, transparent);
    }

    .card-actions{
      display:flex; gap:8px; margin-top:10px; flex-wrap:wrap;
    }
    .icon-btn{
      display:inline-flex; align-items:center; gap:6px;
      padding:7px 10px; border-radius:999px;
      border:1px solid var(--border);
      background:transparent;
      color:var(--text);
      font-size:12px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .icon-btn:hover{background:color-mix(in oklab, var(--primary) 10%, var(--panel)); border-color:color-mix(in oklab, var(--primary) 25%, var(--border))}
    .icon-btn:active{transform: translateY(1px) scale(.99)}
    .icon{
      width:16px;height:16px;display:inline-block;flex:0 0 16px;
    }
    .icon svg{width:16px;height:16px;display:block}
    .on{border-color: color-mix(in oklab, var(--primary) 45%, var(--border)) !important; background: color-mix(in oklab, var(--primary) 12%, var(--panel)) !important}
    .pulse{
      animation:pulse .35s ease-out;
    }
    @keyframes pulse{from{transform:scale(.96)}50%{transform:scale(1.02)}to{transform:scale(1)}}

    /* feed */
    .feed-item{padding:10px 0;border-bottom:1px solid color-mix(in oklab, var(--border2) 70%, transparent);font-size:13px}
    .feed-item:last-child{border-bottom:none}
    .feed-header{color:color-mix(in oklab, var(--text) 80%, var(--muted));margin-bottom:4px}
    .feed-content{margin-bottom:4px;color:color-mix(in oklab, var(--text) 90%, var(--muted))}
    .feed-meta{font-size:11px;color:var(--muted2)}

    /* 侧边栏 */
    .side-block{margin-bottom:16px}
    .badge{
      display:inline-block;padding:3px 8px;margin:2px 6px 2px 0;border-radius:999px;
      background:color-mix(in oklab, var(--ok) 12%, var(--panel));
      border:1px solid color-mix(in oklab, var(--ok) 28%, var(--border));
      font-size:11px;color:color-mix(in oklab, var(--ok) 85%, var(--text));
      cursor:pointer; user-select:none;
      transition: transform .12s ease, background .12s ease;
    }
    .badge:hover{background:color-mix(in oklab, var(--ok) 18%, var(--panel))}
    .badge:active{transform: translateY(1px)}
    .profile-header{display:flex;align-items:center;gap:10px;margin-bottom:10px}
    .avatar{
      width:42px;height:42px;border-radius:50%;
      background:linear-gradient(145deg, color-mix(in oklab, var(--primary) 22%, #ddd), #ddd);
      border:1px solid var(--border);
    }
    .profile-name{font-size:14px;font-weight:750}
    .profile-stat{font-size:11px;color:var(--muted2)}
    .simple-list{font-size:13px;padding-left:16px;margin:0;color:color-mix(in oklab, var(--text) 90%, var(--muted))}
    .simple-list li{margin-bottom:6px}

    /* 详情页 */
    .detail-page{margin-top:10px}
    .breadcrumb{font-size:12px;color:var(--muted2);margin-bottom:8px}
    .breadcrumb a{color:var(--muted2)}
    .detail-header{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:10px}
    .detail-title{font-size:20px;font-weight:850;margin-bottom:4px}
    .detail-sub{font-size:12px;color:var(--muted)}
    .pill{
      display:inline-block;padding:2px 8px;border-radius:999px;
      font-size:11px;border:1px solid var(--border);
      background:color-mix(in oklab, var(--panel) 85%, transparent);
      margin-left:6px;color:var(--muted);
    }
    .detail-grid{display:grid;grid-template-columns:2.2fr 3fr;gap:16px}
    @media (max-width: 900px){.detail-grid{grid-template-columns:1fr}}
    .detail-section-title{font-size:14px;font-weight:750;margin:10px 0 6px}
    .comment-item{border-bottom:1px solid color-mix(in oklab, var(--border2) 70%, transparent);padding:8px 0;font-size:13px}
    .comment-meta{font-size:11px;color:var(--muted2);margin-bottom:3px}
    .comment-actions{font-size:11px;color:var(--muted2)}

    .page-title{font-size:22px;font-weight:750;margin-bottom:12px}

    footer{max-width:1120px;margin:0 auto 40px;padding:0 18px;font-size:12px;color:var(--muted2)}
    footer a{color:var(--muted2)}

    /* 动效：滚动进场 */
    .reveal{opacity:0; transform: translateY(10px); transition: opacity .35s ease, transform .35s ease}
    .reveal.in{opacity:1; transform: translateY(0)}

    /* Drawer / Modal / Overlay */
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.35);
      display:none; z-index:80;
    }
    .overlay.open{display:block; animation:fade .14s ease-out}
    @keyframes fade{from{opacity:0}to{opacity:1}}

    .drawer{
      position:fixed; right:0; top:0; bottom:0;
      width:min(420px, 92vw);
      background:var(--panel);
      border-left:1px solid var(--border);
      box-shadow: var(--shadow);
      transform: translateX(110%);
      transition: transform .18s ease;
      z-index:90;
      display:flex; flex-direction:column;
    }
    .drawer.open{transform: translateX(0)}
    .drawer header{
      position:static; border:none; border-bottom:1px solid var(--border);
      background:transparent; backdrop-filter:none;
      padding:14px 14px;
      display:flex; justify-content:space-between; align-items:center;
    }
    .drawer .content{padding:14px; overflow:auto}
    .field{margin-bottom:12px}
    .field label{display:block;font-size:12px;color:var(--muted2);margin-bottom:6px}
    .field input[type="range"]{width:100%}
    .field .row{display:flex; gap:10px; flex-wrap:wrap}
    .check{
      display:flex; align-items:center; gap:8px;
      padding:8px 10px; border:1px solid var(--border);
      border-radius:12px;
      cursor:pointer; user-select:none;
      background:color-mix(in oklab, var(--panel) 90%, transparent);
    }
    .check input{accent-color: var(--primary)}
    .hint{font-size:12px;color:var(--muted2);line-height:1.5}

    .modal{
      position:fixed; inset:0;
      display:none; z-index:100;
      align-items:center; justify-content:center;
      padding:18px;
    }
    .modal.open{display:flex}
    .modal .panel{
      width:min(720px, 96vw);
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow: var(--shadow);
      overflow:hidden;
      animation: pop .14s ease-out;
    }
    .modal .panel header{
      position:static; border:none; border-bottom:1px solid var(--border);
      background:transparent; backdrop-filter:none;
      padding:14px 16px;
      display:flex; justify-content:space-between; align-items:center;
    }
    .modal .panel .body{padding:14px 16px 16px}
    textarea{
      width:100%; min-height:110px;
      border-radius:12px; border:1px solid var(--border);
      padding:10px 12px; font-size:13px;
      background:transparent; color:var(--text);
      resize:vertical;
    }

    /* 命令面板 */
    .cmdk{
      position:fixed; inset:0;
      display:none; z-index:110;
      align-items:flex-start; justify-content:center;
      padding:72px 18px 18px;
    }
    .cmdk.open{display:flex}
    .cmdk .box{
      width:min(760px, 96vw);
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow: var(--shadow);
      overflow:hidden;
      animation: pop .14s ease-out;
    }
    .cmdk .top{
      padding:12px 12px 10px;
      border-bottom:1px solid var(--border);
      display:flex; gap:10px; align-items:center;
    }
    .cmdk input{
      flex:1;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:transparent;
      color:var(--text);
      font-size:14px;
    }
    .cmdk .list{max-height:420px; overflow:auto}
    .cmdk .row{
      padding:10px 12px;
      display:flex; justify-content:space-between; gap:10px;
      cursor:pointer;
    }
    .cmdk .row:hover{background:color-mix(in oklab, var(--primary) 10%, var(--panel))}
    .cmdk .row .title{font-size:13px; color:var(--text)}
    .cmdk .row .meta{font-size:12px; color:var(--muted2)}
    .cmdk .empty{padding:14px 12px; color:var(--muted2); font-size:13px}

    /* Toast */
    .toast-wrap{position:fixed; left:50%; transform:translateX(-50%); bottom:20px; z-index:200; display:flex; flex-direction:column; gap:10px; pointer-events:none}
    .toast{
      pointer-events:auto;
      min-width:min(520px, 92vw);
      background:color-mix(in oklab, var(--panel) 94%, transparent);
      border:1px solid var(--border);
      border-radius:14px;
      box-shadow: var(--shadow2);
      padding:10px 12px;
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
      animation: toastIn .18s ease-out;
    }
    @keyframes toastIn{from{opacity:0; transform: translateY(8px)}to{opacity:1; transform: translateY(0)}}
    .toast .t-title{font-size:13px; font-weight:750}
    .toast .t-desc{font-size:12px; color:var(--muted2); margin-top:2px}
    .toast .close{border:1px solid var(--border); background:transparent; color:var(--text); border-radius:10px; padding:6px 8px; cursor:pointer}

    /* 浮动按钮 */
    .fab{
      position:fixed; right:18px; bottom:18px;
      z-index:70;
      display:flex; flex-direction:column; gap:10px;
    }
    .fab button{
      width:44px; height:44px; border-radius:14px;
      border:1px solid var(--border);
      background:var(--panel);
      box-shadow: var(--shadow2);
      cursor:pointer;
      transition: transform .12s ease, background .12s ease;
    }
    .fab button:hover{background:color-mix(in oklab, var(--primary) 10%, var(--panel))}
    .fab button:active{transform: translateY(1px)}
    .fab .hide{display:none}

    /* 骨架 */
    .skeleton{
      position:relative;
      background:color-mix(in oklab, var(--panel) 80%, var(--border));
      border-radius:12px;
      overflow:hidden;
    }
    .skeleton::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent);
      transform: translateX(-100%);
      animation: shimmer 1.2s infinite;
    }
    [data-theme="dark"] .skeleton::after{background: linear-gradient(90deg, transparent, rgba(255,255,255,.06), transparent)}
    @keyframes shimmer{to{transform: translateX(100%)}}
  </style>
</head>
<body>
<header>
  <div class="logo" title="MuseumX">
    Museum<span>X</span>
  </div>

  <div class="top-search" role="search">
    <select id="citySelect" aria-label="选择城市">
      <option>上海</option>
      <option>北京</option>
      <option>广州</option>
      <option>深圳</option>
      <option>成都</option>
    </select>
    <input id="globalSearch" type="search" placeholder="搜索博物馆 / 展览 / 用户（支持联想）" autocomplete="off" />
    <div id="suggest" class="suggest" aria-label="搜索联想"></div>
  </div>

  <nav class="top-nav" aria-label="主导航">
    <a href="#home" data-nav="home">首页</a>
    <a href="#exhibition-detail-eg1" data-nav="exhibition">展览</a>
    <a href="#city-beijing" data-nav="city">城市</a>
    <a href="#user-profile-1" data-nav="community">社区</a>
  </nav>

  <div class="right-actions">
    <button class="chip" id="btnCmdk" aria-label="打开快速搜索面板">
      快速跳转 <span class="kbd">Ctrl K</span>
    </button>
    <button class="chip" id="btnFilter" aria-label="打开筛选面板">筛选</button>
    <button class="chip" id="btnTheme" aria-label="切换主题">主题</button>
    <button class="btn-outline btn" id="btnAuth">登录 / 注册</button>
  </div>
</header>

<main id="app">

  <!-- 首页 -->
  <section class="page" id="home">
    <div class="home-layout">
      <div class="main-left">

        <section class="reveal">
          <h2>本城热门博物馆</h2>
          <div class="sub-title">根据近期打卡量、评分、讨论热度综合排序 · 支持收藏/想去</div>

          <div id="museumList" class="card-list" aria-live="polite"></div>

          <div id="museumSkeleton" class="card-list" style="display:none;margin-top:12px">
            <div class="skeleton" style="height:140px"></div>
            <div class="skeleton" style="height:140px"></div>
            <div class="skeleton" style="height:140px"></div>
            <div class="skeleton" style="height:140px"></div>
          </div>
        </section>

        <section class="reveal">
          <h2>正在热展</h2>
          <div class="sub-title">按展览热度排序 · 近期展览 · 支持想看/收藏/点赞</div>

          <div id="exhibitionList" class="card-list" aria-live="polite"></div>

          <div id="exhibitionSkeleton" class="card-list" style="display:none;margin-top:12px">
            <div class="skeleton" style="height:150px"></div>
            <div class="skeleton" style="height:150px"></div>
            <div class="skeleton" style="height:150px"></div>
            <div class="skeleton" style="height:150px"></div>
          </div>
        </section>

        <section class="reveal">
          <h2>精选攻略 · 游记</h2>
          <div class="sub-title">由活跃作者撰写的观展建议</div>
          <ul class="simple-list">
            <li><a href="#article-long-psa">在光与影之间看见 20 世纪 —— 摄影大师联展观展记</a> · by 北方来客</li>
            <li><a href="#user-profile-3">带娃暴走团</a> · <a href="#museum-detail-shanghai-planet">上海天文馆亲子一日路线</a>（示例）</li>
          </ul>
        </section>

        <section class="reveal" id="feed">
          <h2>最新打卡 · 游记</h2>
          <div class="sub-title">关注的人 + 本城最新内容</div>

          <article class="feed-item">
            <div class="feed-header">
              <a href="#user-profile-1">木木是只猫</a> 在 <a href="#museum-detail-shanghai-museum">上海博物馆</a> 打卡 · 标记「看过」
              <a href="#exhibition-detail-eg1">青铜之光</a>
            </div>
            <div class="feed-content">「展品密度非常高，讲解做得比想象中细，建议一定要租语音讲解或者跟团走。」</div>
            <div class="feed-meta">2025-03-21 · 用时约 3 小时 · 安利指数：很推荐</div>
          </article>

          <article class="feed-item">
            <div class="feed-header">
              <a href="#user-profile-2">北方来客</a> 写了长评：<a href="#exhibition-detail-eg3">光与影：20 世纪摄影大师联展</a>
            </div>
            <div class="feed-content">
              「很少有这么系统的摄影展，按时间线和主题分区，既能看到技术演变，也能感受到时代情绪变化……」
              <a href="#article-long-psa">阅读全文 &gt;</a>
            </div>
            <div class="feed-meta">2025-03-20 · 赞 54 · 评论 12 · 收藏 31</div>
          </article>

          <article class="feed-item">
            <div class="feed-header"><a href="#user-profile-3">带娃暴走团</a> 在 <a href="#museum-detail-shanghai-planet">上海天文馆</a> 打卡</div>
            <div class="feed-content">「对 6 岁小朋友非常友好，互动装置多，但周末人非常多，最好避开高峰。」</div>
            <div class="feed-meta">2025-03-19 · 亲子 · 排队约 40 分钟</div>
          </article>
        </section>
      </div>

      <aside class="main-right">
        <section class="side-block reveal">
          <h3>本周榜单 · 口碑最佳展览</h3>
          <ol class="simple-list">
            <li><a href="#exhibition-detail-eg1">青铜之光</a>（评分 4.8）</li>
            <li><a href="#exhibition-detail-eg3">光与影：摄影大师联展</a>（评分 4.6）</li>
            <li><a href="#exhibition-detail-eg2">数字之城</a>（评分 4.4）</li>
          </ol>
        </section>

        <section class="side-block reveal" id="side-user">
          <h3>我的打卡概览</h3>
          <div class="profile-header">
            <div class="avatar" aria-hidden="true"></div>
            <div>
              <div class="profile-name">龚子傲</div>
              <div class="profile-stat">欢迎回来，博物馆游历达人</div>
            </div>
          </div>
          <button class="btn" style="width:100%;">注销</button>
        </section>

        <section class="side-block reveal">
          <h3>热门标签（点选即可筛选）</h3>
          <div id="hotTags">
            <span class="badge" data-tag="亲子友好">亲子友好</span>
            <span class="badge" data-tag="建筑控">建筑控</span>
            <span class="badge" data-tag="当代艺术">当代艺术</span>
            <span class="badge" data-tag="自然科普">自然科普</span>
            <span class="badge" data-tag="免费馆">免费馆</span>
            <span class="badge" data-tag="冷门好馆">冷门好馆</span>
            <span class="badge" data-tag="适合拍照">适合拍照</span>
          </div>
          <div class="hint" style="margin-top:10px">
            提示：也可以打开右上角“筛选”，进行更精细的条件组合。
          </div>
        </section>

        <section class="side-block reveal">
          <h3>发现更多城市</h3>
          <ul class="simple-list">
            <li><a href="#city-beijing">北京 · 112 个博物馆</a></li>
            <li><a href="#city-guangzhou">广州 · 68 个博物馆</a></li>
            <li><a href="#city-chengdu">成都 · 51 个博物馆</a></li>
            <li><a href="#city-more">更多城市 &gt;</a></li>
          </ul>
        </section>
      </aside>
    </div>
  </section>

  <!-- 下面这些详情页沿用你原始内容（为省篇幅我基本保留），只在按钮处加 data-action 以支持互动 -->
  <!-- ================== 详情页开始：博物馆 ================== -->

  <section class="page detail-page" id="museum-detail-shanghai-museum">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; 上海博物馆（人民广场馆）</div>

    <div class="detail-header">
      <div>
        <div class="detail-title">上海博物馆（人民广场馆）</div>
        <div class="detail-sub">
          历史 / 文物 · 黄浦区 人民大道 201 号
          <span class="pill">地铁 1/2/8 号线 人民广场站</span>
        </div>
        <div style="margin-top:6px;font-size:13px;">
          <span class="rating">综合评分 4.7 / 5</span>
          <span class="meta">3.2 万人来过 · 2.1 万条评分 / 点评</span>
        </div>
      </div>
      <div>
        <button class="btn" data-action="checkin" data-id="museum:sh-museum">我来过 · 打卡</button>
        <button class="btn-outline btn" style="margin-left:8px;" data-action="wish" data-id="museum:sh-museum">想去</button>
        <button class="btn-ghost btn" style="margin-left:8px;" data-action="review" data-target="museum:sh-museum">写短评</button>
      </div>
    </div>

    <div class="detail-grid">
      <div>
        <div class="detail-section-title">基本信息</div>
        <ul class="simple-list">
          <li>开放时间：每天 9:00 - 17:00（16:00 停止入场），周一闭馆（节假日除外）</li>
          <li>票务：免费预约入馆，需实名预约</li>
          <li>预约方式：微信公众号「上海博物馆」或官网</li>
          <li>联系电话：021-12345678</li>
          <li>官网：https://www.shanghaimuseum.net/</li>
        </ul>

        <div class="detail-section-title">标签</div>
        <div class="tag-row">
          <span class="tag">常设展丰富</span>
          <span class="tag">中国古代艺术</span>
          <span class="tag">讲解服务</span>
          <span class="tag">适合第一次来上海</span>
        </div>

        <div class="detail-section-title">当前展览</div>
        <ul class="simple-list">
          <li><a href="#exhibition-detail-eg1">「青铜之光」——中国古代青铜文明特展</a>（2025-03-01 ~ 2025-06-30）</li>
          <li><a href="#exhibition-detail-permanent">馆藏经典常设展（书画 / 陶瓷 / 雕塑等）</a>（长期）</li>
        </ul>
      </div>

      <div>
        <div class="detail-section-title">精选点评</div>

        <article class="comment-item">
          <div class="comment-meta"><a href="#user-profile-1">木木是只猫</a> · 评分 5.0 · 打卡第 2 次 · 2025-03-21</div>
          <div class="comment-text">
            非常适合第一次来上海的朋友，馆藏质量没话说，青铜和陶瓷两大展厅必看。
            如果时间不多，建议至少留出 3 小时。
          </div>
          <div class="comment-actions">有用 32 · 没用 1 · 评论 4</div>
        </article>

        <article class="comment-item">
          <div class="comment-meta"><a href="#user-profile-4">静静走路</a> · 评分 4.5 · 2025-03-18</div>
          <div class="comment-text">周末人太多，排队安检就排了半小时，建议工作日来体验更好。展品本身非常值得。</div>
          <div class="comment-actions">有用 18 · 没用 0 · 评论 2</div>
        </article>

        <div style="margin-top:8px;font-size:12px;">
          <a href="#museum-detail-shanghai-museum">查看全部 2.1 万 条评论 &gt;</a>
        </div>

        <div class="detail-section-title">最近打卡</div>
        <ul class="simple-list">
          <li><a href="#user-profile-5">岛屿心情</a> · 今天 10:21 · 首次打卡</li>
          <li><a href="#user-profile-2">北方来客</a> · 昨天 15:03 · 第 3 次打卡</li>
          <li><a href="#user-profile-6">南城读书人</a> · 昨天 11:47 · 首次打卡</li>
        </ul>
      </div>
    </div>
  </section>

  <section class="page detail-page" id="museum-detail-shanghai-plan">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; 上海城市规划展示馆</div>
    <div class="detail-header">
      <div>
        <div class="detail-title">上海城市规划展示馆</div>
        <div class="detail-sub">
          城市 / 建筑 · 黄浦区 人民大道 100 号 <span class="pill">城市规划 · 建筑</span>
        </div>
        <div style="margin-top:6px;font-size:13px;">
          <span class="rating">综合评分 4.4 / 5</span>
          <span class="meta">1.1 万人来过 · 5,321 条评分 / 点评</span>
        </div>
      </div>
      <div>
        <button class="btn" data-action="checkin" data-id="museum:sh-plan">我来过 · 打卡</button>
        <button class="btn-outline btn" style="margin-left:8px;" data-action="wish" data-id="museum:sh-plan">想去</button>
        <button class="btn-ghost btn" style="margin-left:8px;" data-action="review" data-target="museum:sh-plan">写短评</button>
      </div>
    </div>

    <div class="detail-grid">
      <div>
        <div class="detail-section-title">亮点速览</div>
        <ul class="simple-list">
          <li>超大比例城市沙盘，可以从高处俯瞰整个上海城市格局</li>
          <li>通过多媒体展示上海历史变迁与未来规划蓝图</li>
          <li>适合建筑、城市研究相关专业学生及爱好者</li>
        </ul>

        <div class="detail-section-title">当前展览</div>
        <ul class="simple-list">
          <li><a href="#exhibition-detail-eg2">数字之城：未来城市交互体验展</a></li>
        </ul>
      </div>

      <div>
        <div class="detail-section-title">精选点评节选</div>
        <article class="comment-item">
          <div class="comment-meta"><a href="#user-profile-2">北方来客</a> · 评分 4.5 · 2025-03-10</div>
          <div class="comment-text">对不了解上海的人来说，是一堂很系统的「上海城市发展概论」。</div>
          <div class="comment-actions">有用 21 · 没用 1</div>
        </article>
      </div>
    </div>
  </section>

  <section class="page detail-page" id="museum-detail-shanghai-art">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; 上海当代艺术博物馆（PSA）</div>
    <div class="detail-header">
      <div>
        <div class="detail-title">上海当代艺术博物馆（PSA）</div>
        <div class="detail-sub">艺术 / 设计 · 黄浦区 花园港路 200 号 <span class="pill">黄浦江畔 · 工业改造建筑</span></div>
        <div style="margin-top:6px;font-size:13px;">
          <span class="rating">综合评分 4.3 / 5</span>
          <span class="meta">2.0 万人来过 · 1.5 万条评分 / 点评</span>
        </div>
      </div>
      <div>
        <button class="btn" data-action="checkin" data-id="museum:sh-psa">我来过 · 打卡</button>
        <button class="btn-outline btn" style="margin-left:8px;" data-action="wish" data-id="museum:sh-psa">想去</button>
        <button class="btn-ghost btn" style="margin-left:8px;" data-action="review" data-target="museum:sh-psa">写短评</button>
      </div>
    </div>

    <div class="detail-grid">
      <div>
        <div class="detail-section-title">馆况简介</div>
        <ul class="simple-list">
          <li>改造自南市发电厂，是上海地标性的当代艺术场馆</li>
          <li>临时展为主，题材从影像、装置到设计展览不等</li>
          <li>部分展览免费，部分需要单独购票</li>
        </ul>

        <div class="detail-section-title">当前热门展览</div>
        <ul class="simple-list">
          <li><a href="#exhibition-detail-eg3">光与影：20 世纪摄影大师联展</a></li>
        </ul>
      </div>
      <div>
        <div class="detail-section-title">最近动态</div>
        <ul class="simple-list">
          <li><a href="#user-profile-1">木木是只猫</a> · 游记 · <a href="#article-long-psa">在 PSA 的一日观察</a></li>
        </ul>
      </div>
    </div>
  </section>

  <section class="page detail-page" id="museum-detail-shanghai-planet">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; 上海天文馆</div>
    <div class="detail-header">
      <div>
        <div class="detail-title">上海天文馆</div>
        <div class="detail-sub">科技 / 自然 · 浦东新区 临港大道 380 号 <span class="pill">亲子 · 科普</span></div>
        <div style="margin-top:6px;font-size:13px;">
          <span class="rating">综合评分 4.6 / 5</span>
          <span class="meta">8,932 人来过 · 6,120 条评分 / 点评</span>
        </div>
      </div>
      <div>
        <button class="btn" data-action="checkin" data-id="museum:sh-planet">我来过 · 打卡</button>
        <button class="btn-outline btn" style="margin-left:8px;" data-action="wish" data-id="museum:sh-planet">想去</button>
        <button class="btn-ghost btn" style="margin-left:8px;" data-action="review" data-target="museum:sh-planet">写短评</button>
      </div>
    </div>

    <div class="detail-grid">
      <div>
        <div class="detail-section-title">游览贴士</div>
        <ul class="simple-list">
          <li>周末和节假日较为拥挤，建议提前预约并尽量选择工作日</li>
          <li>有多场球幕影院、宇宙剧场放映，可提前查看场次时间</li>
          <li>适合 6 岁以上儿童，可以边玩边学基础天文学知识</li>
        </ul>

        <div class="detail-section-title">当前热门展览 / 项目</div>
        <ul class="simple-list">
          <li><a href="#exhibition-detail-eg4">星际漫游：人类与宇宙的对话</a></li>
        </ul>
      </div>
      <div>
        <div class="detail-section-title">家长评价</div>
        <article class="comment-item">
          <div class="comment-meta"><a href="#user-profile-3">带娃暴走团</a> · 评分 4.5 · 2025-03-19</div>
          <div class="comment-text">小朋友很喜欢互动装置，就是排队时间有点长，建议早点到。</div>
          <div class="comment-actions">有用 30 · 没用 2</div>
        </article>
      </div>
    </div>
  </section>

  <!-- ================== 展览详情页 ================== -->

  <section class="page detail-page" id="exhibition-detail-eg1">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; <a href="#museum-detail-shanghai-museum">上海博物馆</a> &gt; 青铜之光</div>
    <div class="detail-header">
      <div>
        <div class="detail-title">「青铜之光」——中国古代青铜文明特展</div>
        <div class="detail-sub">
          上海博物馆 · 2025-03-01 ~ 2025-06-30
          <span class="pill">考古 · 文物</span>
          <span class="pill">适合深度游</span>
        </div>
        <div style="margin-top:6px;font-size:13px;">
          <span class="rating">展览评分 4.8 / 5</span>
          <span class="meta">8,120 人看过 · 1,345 条评论 · 23,421 人标记「想看」</span>
        </div>
      </div>
      <div>
        <button class="btn" data-action="checkin" data-id="exh:eg1">我看过 · 打卡</button>
        <button class="btn-outline btn" style="margin-left:8px;" data-action="wish" data-id="exh:eg1">想看</button>
        <button class="btn-ghost btn" style="margin-left:8px;" data-action="review" data-target="exh:eg1">写短评</button>
      </div>
    </div>

    <div class="detail-grid">
      <div>
        <div class="detail-section-title">展览简介</div>
        <p style="font-size:13px;line-height:1.6;">
          本次展览汇集国内多家博物馆收藏的珍贵青铜器，以时间为轴线，
          系统一览从商周到秦汉的青铜文明发展历程。通过多媒体互动和还原场景，
          带领观众走进古人的礼制、战争与日常生活。
        </p>

        <div class="detail-section-title">看展须知</div>
        <ul class="simple-list">
          <li>建议观展时长：2 - 3 小时</li>
          <li>是否需要单独购票：无需单独购票，凭上海博物馆预约码入馆即可</li>
          <li>讲解服务：提供人工讲解、语音导览，可现场租借设备</li>
        </ul>
      </div>

      <div>
        <div class="detail-section-title">观众印象标签</div>
        <div class="tag-row">
          <span class="tag">文物量大</span>
          <span class="tag">布展清晰</span>
          <span class="tag">值得二刷</span>
          <span class="tag">适合历史爱好者</span>
          <span class="tag">需要一点基础</span>
        </div>

        <div class="detail-section-title">短评节选</div>
        <article class="comment-item">
          <div class="comment-meta"><a href="#user-profile-7">考古小张</a> · 评分 5.0 · 2025-03-16</div>
          <div class="comment-text">作为文博专业学生狂喜的一次展览，展品级别很高，而且文字说明难得不啰嗦。</div>
          <div class="comment-actions">有用 40 · 没用 0</div>
        </article>

        <article class="comment-item">
          <div class="comment-meta"><a href="#user-profile-3">带娃暴走团</a> · 评分 4.0 · 2025-03-15</div>
          <div class="comment-text">内容很好，但对小朋友来说有点难，建议先在家看点相关动画片预热。</div>
          <div class="comment-actions">有用 15 · 没用 1</div>
        </article>

        <div style="margin-top:8px;font-size:12px;">
          <a href="#exhibition-detail-eg1" data-action="review" data-target="exh:eg1">写短评 / 游记 &gt;</a> ·
          <a href="#exhibition-detail-eg1">查看全部 1,345 条评论 &gt;</a>
        </div>
      </div>
    </div>
  </section>

  <section class="page detail-page" id="exhibition-detail-eg2">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; <a href="#museum-detail-shanghai-plan">上海城市规划展示馆</a> &gt; 数字之城</div>
    <div class="detail-header">
      <div>
        <div class="detail-title">数字之城：未来城市交互体验展</div>
        <div class="detail-sub">上海城市规划展示馆 · 2025-02-10 ~ 2025-05-10 <span class="pill">互动 · 沉浸式</span></div>
        <div style="margin-top:6px;font-size:13px;">
          <span class="rating">展览评分 4.4 / 5</span>
          <span class="meta">3,421 人看过 · 842 条评论</span>
        </div>
      </div>
      <div>
        <button class="btn" data-action="checkin" data-id="exh:eg2">我看过 · 打卡</button>
        <button class="btn-outline btn" style="margin-left:8px;" data-action="wish" data-id="exh:eg2">想看</button>
        <button class="btn-ghost btn" style="margin-left:8px;" data-action="review" data-target="exh:eg2">写短评</button>
      </div>
    </div>
    <div class="detail-grid">
      <div>
        <div class="detail-section-title">展览亮点</div>
        <ul class="simple-list">
          <li>通过交互装置体验「智慧交通 / 智能建筑 / 数字孪生城市」</li>
          <li>适合拍照，部分区域有灯光与影像互动</li>
        </ul>
      </div>
      <div>
        <div class="detail-section-title">适合人群</div>
        <ul class="simple-list">
          <li>对未来城市、科技感兴趣的观众</li>
          <li>亲子家庭（建议 8 岁以上）</li>
        </ul>
      </div>
    </div>
  </section>

  <section class="page detail-page" id="exhibition-detail-eg3">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; <a href="#museum-detail-shanghai-art">上海当代艺术博物馆</a> &gt; 光与影</div>
    <div class="detail-header">
      <div>
        <div class="detail-title">光与影：20 世纪摄影大师联展</div>
        <div class="detail-sub">上海当代艺术博物馆 · 2025-01-20 ~ 2025-04-15 <span class="pill">摄影 · 影像艺术</span></div>
        <div style="margin-top:6px;font-size:13px;">
          <span class="rating">展览评分 4.6 / 5</span>
          <span class="meta">5,532 人看过 · 1,233 条评论</span>
        </div>
      </div>
      <div>
        <button class="btn" data-action="checkin" data-id="exh:eg3">我看过 · 打卡</button>
        <button class="btn-outline btn" style="margin-left:8px;" data-action="wish" data-id="exh:eg3">想看</button>
        <button class="btn-ghost btn" style="margin-left:8px;" data-action="review" data-target="exh:eg3">写短评</button>
      </div>
    </div>
    <div class="detail-grid">
      <div>
        <div class="detail-section-title">展览结构</div>
        <ul class="simple-list">
          <li>按时间线梳理 20 世纪摄影技术与风格的演变</li>
          <li>按主题分区：战争与和平、城市与日常、身体与自我等</li>
        </ul>
      </div>
      <div>
        <div class="detail-section-title">相关文章</div>
        <ul class="simple-list">
          <li><a href="#article-long-psa">长评：在光与影之间看见 20 世纪</a> · by 北方来客</li>
        </ul>
      </div>
    </div>
  </section>

  <section class="page detail-page" id="exhibition-detail-eg4">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; <a href="#museum-detail-shanghai-planet">上海天文馆</a> &gt; 星际漫游</div>
    <div class="detail-header">
      <div>
        <div class="detail-title">星际漫游：人类与宇宙的对话</div>
        <div class="detail-sub">上海天文馆 · 2025-03-15 ~ 2025-08-31 <span class="pill">天文科普</span><span class="pill">亲子</span></div>
        <div style="margin-top:6px;font-size:13px;">
          <span class="rating">展览评分 4.7 / 5</span>
          <span class="meta">2,153 人看过 · 502 条评论</span>
        </div>
      </div>
      <div>
        <button class="btn" data-action="checkin" data-id="exh:eg4">我看过 · 打卡</button>
        <button class="btn-outline btn" style="margin-left:8px;" data-action="wish" data-id="exh:eg4">想看</button>
        <button class="btn-ghost btn" style="margin-left:8px;" data-action="review" data-target="exh:eg4">写短评</button>
      </div>
    </div>
    <div class="detail-grid">
      <div>
        <div class="detail-section-title">推荐玩法</div>
        <ul class="simple-list">
          <li>先看球幕影院，再进入主展厅体验互动装置</li>
          <li>可以让孩子先在家看一些太空题材动画，再来现场「对上号」</li>
        </ul>
      </div>
      <div>
        <div class="detail-section-title">家长建议</div>
        <ul class="simple-list">
          <li>为避免排队，尽量选择早场或工作日</li>
        </ul>
      </div>
    </div>
  </section>

  <section class="page detail-page" id="exhibition-detail-permanent">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; <a href="#museum-detail-shanghai-museum">上海博物馆</a> &gt; 常设展</div>
    <div class="detail-title">馆藏经典常设展（上海博物馆）</div>
    <p style="font-size:13px;line-height:1.6;">
      常设展分为多个专题展厅，如中国古代青铜馆、中国古代陶瓷馆、中国历代书法馆等，
      适合首次来访者按自己兴趣选择 2–3 个重点展厅慢慢看。
    </p>
  </section>

  <!-- ================== 用户主页 / 城市 / 长文（保留原内容） ================== -->

  <section class="page detail-page" id="user-profile-1">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; 用户 · 木木是只猫</div>
    <div class="detail-header">
      <div class="profile-header">
        <div class="avatar" aria-hidden="true"></div>
        <div>
          <div class="profile-name">木木是只猫</div>
          <div class="profile-stat">上海 · 观展 86 次 · 关注 132 人 · 被 420 人关注</div>
          <div style="font-size:11px;color:var(--muted2);margin-top:4px;">
            自我介绍：爱逛博物馆的设计师，主要写当代艺术 / 城市历史相关的观展记录。
          </div>
        </div>
      </div>
      <div><button class="btn-outline btn" data-action="follow" data-id="user:1">关注</button></div>
    </div>

    <div class="detail-grid">
      <div>
        <div class="detail-section-title">观展足迹</div>
        <ul class="simple-list">
          <li>2025 年已打卡：12 馆 · 18 场展览</li>
          <li>累计打卡：32 馆 · 64 场展览</li>
          <li>去过城市：上海、北京、广州、京都</li>
        </ul>

        <div class="detail-section-title">徽章 / 成就（示例）</div>
        <div>
          <span class="badge">上海博物馆三刷</span>
          <span class="badge">当代艺术 20+ 展</span>
          <span class="badge">跨城观展</span>
        </div>
      </div>

      <div>
        <div class="detail-section-title">最近打卡与点评</div>

        <article class="feed-item">
          <div class="feed-header">打卡 · <a href="#museum-detail-shanghai-museum">上海博物馆</a> · 第 2 次</div>
          <div class="feed-content">「青铜展真的很值得细看，这次专门带外地朋友来，大家都很满意。」</div>
          <div class="feed-meta">2025-03-21 · 评分 5.0</div>
        </article>

        <article class="feed-item">
          <div class="feed-header">短评 · <a href="#exhibition-detail-eg3">光与影：20 世纪摄影大师联展</a></div>
          <div class="feed-content">「布光太美了，展场空间与作品氛围很统一。」</div>
          <div class="feed-meta">2025-03-12 · 评分 4.5</div>
        </article>

        <article class="feed-item">
          <div class="feed-header">游记 · <a href="#museum-detail-shanghai-art">上海当代艺术博物馆</a></div>
          <div class="feed-content">「最近的主题展让我重新对当代艺术有点信心了，写了一篇小长文记录一下。」 <a href="#article-long-psa">阅读全文 &gt;</a></div>
          <div class="feed-meta">2025-03-01 · 赞 27 · 评论 6</div>
        </article>
      </div>
    </div>
  </section>

  <section class="page detail-page" id="user-profile-2">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; 用户 · 北方来客</div>
    <div class="detail-header">
      <div class="profile-header">
        <div class="avatar"></div>
        <div>
          <div class="profile-name">北方来客</div>
          <div class="profile-stat">北京 / 上海两地往返 · 观展 52 次</div>
        </div>
      </div>
      <div><button class="btn-outline btn" data-action="follow" data-id="user:2">关注</button></div>
    </div>
    <div class="detail-section-title">代表作品</div>
    <ul class="simple-list">
      <li>长评 · <a href="#exhibition-detail-eg3">光与影：20 世纪摄影大师联展</a></li>
      <li>游记 · <a href="#museum-detail-shanghai-museum">再逛上海博物馆：青铜与书画</a></li>
    </ul>
  </section>

  <section class="page detail-page" id="user-profile-3">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; 用户 · 带娃暴走团</div>
    <div class="detail-header">
      <div class="profile-header">
        <div class="avatar"></div>
        <div>
          <div class="profile-name">带娃暴走团</div>
          <div class="profile-stat">亲子向博物馆攻略 · 观展 40 次</div>
        </div>
      </div>
      <div><button class="btn-outline btn" data-action="follow" data-id="user:3">关注</button></div>
    </div>
    <div class="detail-section-title">近期亲子打卡</div>
    <ul class="simple-list">
      <li><a href="#museum-detail-shanghai-planet">上海天文馆</a></li>
      <li><a href="#exhibition-detail-eg1">青铜之光</a>（带 8 岁小朋友）</li>
    </ul>
  </section>

  <section class="page detail-page" id="user-profile-4">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; 用户 · 静静走路</div>
    <div class="detail-header">
      <div class="profile-header">
        <div class="avatar"></div>
        <div>
          <div class="profile-name">静静走路</div>
          <div class="profile-stat">喜欢工作日慢逛博物馆</div>
        </div>
      </div>
    </div>
  </section>

  <section class="page detail-page" id="user-profile-5">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; 用户 · 岛屿心情</div>
    <div class="detail-header">
      <div class="profile-header">
        <div class="avatar"></div>
        <div>
          <div class="profile-name">岛屿心情</div>
          <div class="profile-stat">第一次打卡上海博物馆</div>
        </div>
      </div>
    </div>
  </section>

  <section class="page detail-page" id="user-profile-6">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; 用户 · 南城读书人</div>
    <div class="detail-header">
      <div class="profile-header">
        <div class="avatar"></div>
        <div>
          <div class="profile-name">南城读书人</div>
          <div class="profile-stat">在城市中寻找安静展厅</div>
        </div>
      </div>
    </div>
  </section>

  <section class="page detail-page" id="user-profile-7">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; 用户 · 考古小张</div>
    <div class="detail-header">
      <div class="profile-header">
        <div class="avatar"></div>
        <div>
          <div class="profile-name">考古小张</div>
          <div class="profile-stat">文博专业学生 · 爱写展览笔记</div>
        </div>
      </div>
    </div>
  </section>

  <section class="page detail-page" id="city-beijing">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; 城市 · 北京</div>
    <div class="page-title">北京 · 部分博物馆示例</div>
    <ul class="simple-list"><li>中国国家博物馆</li><li>故宫博物院</li><li>首都博物馆</li></ul>
  </section>

  <section class="page detail-page" id="city-guangzhou">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; 城市 · 广州</div>
    <div class="page-title">广州 · 部分博物馆示例</div>
    <ul class="simple-list"><li>广东省博物馆</li><li>广东美术馆</li></ul>
  </section>

  <section class="page detail-page" id="city-chengdu">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; 城市 · 成都</div>
    <div class="page-title">成都 · 部分博物馆示例</div>
    <ul class="simple-list"><li>成都博物馆</li><li>金沙遗址博物馆</li></ul>
  </section>

  <section class="page detail-page" id="city-more">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; 更多城市</div>
    <div class="page-title">更多城市</div>
    <p style="font-size:13px;">更多城市与博物馆数据正在丰富中，敬请期待。</p>
  </section>

  <section class="page detail-page" id="article-long-psa">
    <div class="breadcrumb"><a href="#home">首页</a> &gt; <a href="#exhibition-detail-eg3">光与影：摄影大师联展</a> &gt; 观展记</div>
    <div class="detail-header">
      <div>
        <div class="detail-title">在光与影之间看见 20 世纪 —— 摄影大师联展观展记</div>
        <div class="detail-sub">作者：北方来客 · 关联展览： <a href="#exhibition-detail-eg3">光与影：20 世纪摄影大师联展</a></div>
      </div>
    </div>
    <p style="font-size:13px;line-height:1.8;">这是一篇示例长文内容占位。</p>
  </section>

</main>

<footer>
  <p>中国传媒大学 2025 保留一切权力</p>
  <p><a href="#home">回到首页</a></p>
</footer>

<!-- Overlay / Drawer / Modal / Cmdk / Toast / FAB -->
<div id="overlay" class="overlay" tabindex="-1" aria-hidden="true"></div>

<div id="drawer" class="drawer" role="dialog" aria-modal="true" aria-label="筛选面板">
  <header>
    <div style="font-weight:850">筛选</div>
    <button class="btn-ghost btn btn-small" id="closeDrawer">关闭</button>
  </header>
  <div class="content">
    <div class="field">
      <label>类型</label>
      <div class="row">
        <label class="check"><input type="checkbox" value="museum" id="fTypeMuseum" checked />博物馆</label>
        <label class="check"><input type="checkbox" value="exhibition" id="fTypeExh" checked />展览</label>
      </div>
    </div>

    <div class="field">
      <label>最低评分：<span id="minRatingText">4.0</span></label>
      <input id="minRating" type="range" min="3.5" max="5.0" step="0.1" value="4.0" />
    </div>

    <div class="field">
      <label>偏好</label>
      <div class="row">
        <label class="check"><input id="fFree" type="checkbox" />免费/免票</label>
        <label class="check"><input id="fFamily" type="checkbox" />亲子友好</label>
        <label class="check"><input id="fPhoto" type="checkbox" />适合拍照</label>
      </div>
      <div class="hint" style="margin-top:8px">提示：也可以点击右侧“热门标签”一键套用。</div>
    </div>

    <div class="field">
      <label>标签包含（逗号分隔）</label>
      <input id="fTags" type="text" placeholder="例如：当代艺术, 建筑控" style="width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:transparent;color:var(--text)" />
    </div>

    <div style="display:flex;gap:10px; margin-top:14px;">
      <button class="btn" id="applyFilter" style="flex:1">应用筛选</button>
      <button class="btn-outline btn" id="resetFilter" style="flex:1">重置</button>
    </div>
  </div>
</div>

<div id="modal" class="modal" role="dialog" aria-modal="true" aria-label="写短评">
  <div class="panel">
    <header>
      <div>
        <div style="font-weight:850">写短评</div>
        <div id="modalSub" style="font-size:12px;color:var(--muted2);margin-top:2px;">——</div>
      </div>
      <button class="btn-ghost btn btn-small" id="closeModal">关闭</button>
    </header>
    <div class="body">
      <div class="field">
        <label>评分（1-5）</label>
        <input id="reviewScore" type="range" min="1" max="5" step="0.5" value="4.5" />
        <div class="hint">当前：<span id="reviewScoreText">4.5</span></div>
      </div>
      <div class="field">
        <label>内容</label>
        <textarea id="reviewText" placeholder="写点你的感受、避坑建议、推荐路线……"></textarea>
      </div>
      <div style="display:flex;gap:10px;justify-content:flex-end">
        <button class="btn-outline btn" id="cancelReview">取消</button>
        <button class="btn" id="submitReview">提交</button>
      </div>
    </div>
  </div>
</div>

<div id="cmdk" class="cmdk" role="dialog" aria-modal="true" aria-label="快速跳转">
  <div class="box">
    <div class="top">
      <input id="cmdkInput" type="text" placeholder="输入关键词：博物馆 / 展览 / 用户 / 城市…" />
      <span class="kbd">Esc</span>
    </div>
    <div id="cmdkList" class="list"></div>
  </div>
</div>

<div id="toastWrap" class="toast-wrap" aria-live="polite" aria-atomic="true"></div>

<div class="fab" aria-label="悬浮操作">
  <button id="btnTop" class="hide" aria-label="回到顶部">
    <span class="icon" aria-hidden="true">
      <svg viewBox="0 0 24 24" fill="none"><path d="M12 5l7 7-1.4 1.4L13 8.8V20h-2V8.8L6.4 13.4 5 12l7-7z" fill="currentColor"/></svg>
    </span>
  </button>
</div>

<script>
(function(){
  const $ = (s, el=document)=>el.querySelector(s);
  const $$ = (s, el=document)=>Array.from(el.querySelectorAll(s));

  const store = {
    get(key, fallback){
      try{
        const v = localStorage.getItem(key);
        return v ? JSON.parse(v) : fallback;
      }catch(e){ return fallback; }
    },
    set(key, value){
      localStorage.setItem(key, JSON.stringify(value));
    }
  };

  const state = {
    theme: store.get('mx_theme', 'light'),
    actions: store.get('mx_actions', {
      wish: {},
      fav: {},
      like: {},
      checkin: {},
      follow: {}
    }),
    filter: store.get('mx_filter', {
      typeMuseum: true,
      typeExh: true,
      minRating: 4.0,
      free: false,
      family: false,
      photo: false,
      tags: []
    }),
    reviewTarget: null
  };

  // 主题
  function applyTheme(){
    document.documentElement.setAttribute('data-theme', state.theme);
    store.set('mx_theme', state.theme);
  }
  applyTheme();

  // 数据（为首页渲染使用，详情页仍用原静态内容）
  const museums = [
    {
      id:'museum-detail-shanghai-museum',
      key:'museum:sh-museum',
      title:'上海博物馆（人民广场馆）',
      subtitle:'历史 / 文物 · 黄浦区 人民大道 201 号',
      rating:4.7, visits:'3.2 万人来过', comments:'2.1 万条点评',
      tags:['常设展丰富','适合第一次来上海','中文讲解不错','免费馆'],
      family:true, photo:true, free:true
    },
    {
      id:'museum-detail-shanghai-plan',
      key:'museum:sh-plan',
      title:'上海城市规划展示馆',
      subtitle:'城市 / 建筑 · 黄浦区 人民大道 100 号',
      rating:4.4, visits:'1.1 万人来过', comments:'5,321 条点评',
      tags:['城市沙盘','适合建筑爱好者','亲子友好','建筑控','适合拍照'],
      family:true, photo:true, free:false
    },
    {
      id:'museum-detail-shanghai-art',
      key:'museum:sh-psa',
      title:'上海当代艺术博物馆（PSA）',
      subtitle:'艺术 / 设计 · 黄浦区 花园港路 200 号',
      rating:4.3, visits:'2.0 万人来过', comments:'1.5 万条点评',
      tags:['当代艺术','江景好','临时展多','适合拍照'],
      family:false, photo:true, free:false
    },
    {
      id:'museum-detail-shanghai-planet',
      key:'museum:sh-planet',
      title:'上海天文馆',
      subtitle:'科技 / 自然 · 浦东新区 临港大道 380 号',
      rating:4.6, visits:'8,932 人来过', comments:'6,120 条点评',
      tags:['适合亲子','预约热门','科普性强','自然科普','亲子友好'],
      family:true, photo:true, free:false
    }
  ];

  const exhibitions = [
    {
      id:'exhibition-detail-eg1',
      key:'exh:eg1',
      title:'「青铜之光」——中国古代青铜文明特展',
      subtitle:'上海博物馆 · 2025-03-01 ~ 2025-06-30',
      rating:4.8, views:'8,120 人看过', comments:'1,345 条评论',
      tags:['国宝级文物','策展清晰','推荐至少 2 小时'],
      family:false, photo:false, free:true
    },
    {
      id:'exhibition-detail-eg2',
      key:'exh:eg2',
      title:'数字之城：未来城市交互体验展',
      subtitle:'上海城市规划展示馆 · 2025-02-10 ~ 2025-05-10',
      rating:4.4, views:'3,421 人看过', comments:'842 条评论',
      tags:['沉浸式','互动装置','适合拍照'],
      family:true, photo:true, free:false
    },
    {
      id:'exhibition-detail-eg3',
      key:'exh:eg3',
      title:'光与影：20 世纪摄影大师联展',
      subtitle:'上海当代艺术博物馆 · 2025-01-20 ~ 2025-04-15',
      rating:4.6, views:'5,532 人看过', comments:'1,233 条评论',
      tags:['影像艺术','多媒体','适合拍照','当代艺术'],
      family:false, photo:true, free:false
    },
    {
      id:'exhibition-detail-eg4',
      key:'exh:eg4',
      title:'星际漫游：人类与宇宙的对话',
      subtitle:'上海天文馆 · 2025-03-15 ~ 2025-08-31',
      rating:4.7, views:'2,153 人看过', comments:'502 条评论',
      tags:['天文科普','亲子','互动装置'],
      family:true, photo:false, free:false
    }
  ];

  function iconSvg(name){
    const map = {
      fav: '<svg viewBox="0 0 24 24" fill="none"><path d="M12 17.3l-6.2 3.7 1.7-7.1L2 8.9l7.3-.6L12 1.8l2.7 6.5 7.3.6-5.5 5 1.7 7.1L12 17.3z" fill="currentColor"/></svg>',
      wish: '<svg viewBox="0 0 24 24" fill="none"><path d="M12 21s-7-4.4-9.5-8.7C.5 8.6 3.1 5 6.9 5c2 0 3.4 1.1 4.1 2.1C11.7 6.1 13.1 5 15.1 5 18.9 5 21.5 8.6 19.5 12.3 17 16.6 12 21 12 21z" fill="currentColor"/></svg>',
      like: '<svg viewBox="0 0 24 24" fill="none"><path d="M7 10v10H4V10h3zm13.9 1.6c.2-.6.1-1.3-.3-1.8-.4-.5-1-.8-1.6-.8H14l.7-3.4v-.4c0-.5-.2-1-.6-1.4L13 2 7.6 7.4C7.2 7.8 7 8.4 7 9v1h11.7c.9 0 1.6.7 1.6 1.6 0 .1 0 .3-.1.4l-1.7 6c-.2.8-1 1.4-1.8 1.4H9.5V10h1.2l.9-1h7.4c.6 0 1.1.3 1.4.8.3.5.4 1.1.2 1.8z" fill="currentColor"/></svg>',
      checkin: '<svg viewBox="0 0 24 24" fill="none"><path d="M9.5 16.2L5.8 12.5 4.4 13.9l5.1 5.1L20 8.5 18.6 7.1 9.5 16.2z" fill="currentColor"/></svg>'
    };
    return map[name] || '';
  }

  function toast(title, desc){
    const wrap = $('#toastWrap');
    const el = document.createElement('div');
    el.className = 'toast';
    el.innerHTML = `
      <div>
        <div class="t-title">${title}</div>
        ${desc ? `<div class="t-desc">${desc}</div>` : ``}
      </div>
      <button class="close" aria-label="关闭提示">关闭</button>
    `;
    wrap.appendChild(el);
    const t = setTimeout(()=>{ el.remove(); }, 3200);
    $('.close', el).addEventListener('click', ()=>{ clearTimeout(t); el.remove(); });
  }

  function toggleAction(type, id){
    const bucket = state.actions[type] || {};
    bucket[id] = !bucket[id];
    state.actions[type] = bucket;
    store.set('mx_actions', state.actions);
    return bucket[id];
  }

  function isOn(type, id){
    return !!(state.actions[type] && state.actions[type][id]);
  }

  function renderCard(item, kind){
    const tagsHtml = item.tags.slice(0,3).map(t=>`<span class="tag">${t}</span>`).join('');
    const meta = kind==='museum'
      ? `<span class="meta">${item.visits} · ${item.comments}</span>`
      : `<span class="meta">${item.views} · ${item.comments}</span>`;

    const wishLabel = kind==='museum' ? '想去' : '想看';
    const wishOn = isOn('wish', item.key);
    const favOn = isOn('fav', item.key);
    const likeOn = isOn('like', item.key);

    return `
      <article class="card reveal" data-kind="${kind}" data-key="${item.key}" data-rating="${item.rating}" data-tags="${item.tags.join(',')}">
        <div class="card-title"><a href="#${item.id}">${item.title}</a></div>
        <div class="card-subtitle">${item.subtitle}</div>
        <div>
          <span class="rating">评分 ${item.rating.toFixed(1)} / 5</span>
          ${meta}
        </div>
        <div class="tag-row">${tagsHtml}</div>
        <div class="card-actions">
          <button class="icon-btn ${wishOn?'on':''}" data-action="wish" data-id="${item.key}">
            <span class="icon" aria-hidden="true">${iconSvg('wish')}</span>${wishLabel}
          </button>
          <button class="icon-btn ${favOn?'on':''}" data-action="fav" data-id="${item.key}">
            <span class="icon" aria-hidden="true">${iconSvg('fav')}</span>收藏
          </button>
          <button class="icon-btn ${likeOn?'on':''}" data-action="like" data-id="${item.key}">
            <span class="icon" aria-hidden="true">${iconSvg('like')}</span>点赞
          </button>
          <button class="icon-btn" data-action="review" data-target="${item.key}">
            <span class="icon" aria-hidden="true">${iconSvg('checkin')}</span>写短评
          </button>
        </div>
      </article>
    `;
  }

  function passesFilter(item, kind){
    const f = state.filter;
    if(kind==='museum' && !f.typeMuseum) return false;
    if(kind==='exhibition' && !f.typeExh) return false;
    if(item.rating < f.minRating) return false;
    if(f.free && !item.free) return false;
    if(f.family && !item.family) return false;
    if(f.photo && !item.photo) return false;

    if(f.tags && f.tags.length){
      const s = new Set(item.tags);
      for(const t of f.tags){
        if(!s.has(t)) return false;
      }
    }
    return true;
  }

  function renderHome(){
    const museumList = $('#museumList');
    const exhibitionList = $('#exhibitionList');
    const ms = museums.filter(m=>passesFilter(m,'museum'));
    const es = exhibitions.filter(e=>passesFilter(e,'exhibition'));

    museumList.innerHTML = ms.length
      ? ms.map(m=>renderCard(m,'museum')).join('')
      : `<div style="grid-column:1/-1;color:var(--muted2);font-size:13px;padding:8px 2px;">没有符合条件的博物馆结果，试试放宽筛选。</div>`;

    exhibitionList.innerHTML = es.length
      ? es.map(e=>renderCard(e,'exhibition')).join('')
      : `<div style="grid-column:1/-1;color:var(--muted2);font-size:13px;padding:8px 2px;">没有符合条件的展览结果，试试放宽筛选。</div>`;

    observeReveal();
  }

  // 模拟加载态
  function fakeLoading(fn){
    $('#museumSkeleton').style.display = 'grid';
    $('#exhibitionSkeleton').style.display = 'grid';
    $('#museumList').innerHTML = '';
    $('#exhibitionList').innerHTML = '';
    setTimeout(()=>{
      $('#museumSkeleton').style.display = 'none';
      $('#exhibitionSkeleton').style.display = 'none';
      fn();
    }, 220);
  }

  // 搜索联想 + 跳转
  const suggest = $('#suggest');
  const searchInput = $('#globalSearch');

  function buildSearchIndex(){
    const list = [];
    museums.forEach(m=>list.push({label:m.title, type:'博物馆', hash:'#'+m.id}));
    exhibitions.forEach(e=>list.push({label:e.title, type:'展览', hash:'#'+e.id}));
    list.push({label:'北京', type:'城市', hash:'#city-beijing'});
    list.push({label:'广州', type:'城市', hash:'#city-guangzhou'});
    list.push({label:'成都', type:'城市', hash:'#city-chengdu'});
    list.push({label:'木木是只猫', type:'用户', hash:'#user-profile-1'});
    list.push({label:'北方来客', type:'用户', hash:'#user-profile-2'});
    list.push({label:'带娃暴走团', type:'用户', hash:'#user-profile-3'});
    return list;
  }
  const searchIndex = buildSearchIndex();

  function openSuggest(items){
    if(!items.length){ closeSuggest(); return; }
    suggest.classList.add('open');
    suggest.innerHTML = items.slice(0,6).map(it=>`
      <div class="item" role="option" tabindex="0" data-hash="${it.hash}">
        <div>${it.label}</div><div class="type">${it.type}</div>
      </div>
    `).join('');
  }
  function closeSuggest(){
    suggest.classList.remove('open');
    suggest.innerHTML = '';
  }

  searchInput.addEventListener('input', ()=>{
    const q = searchInput.value.trim().toLowerCase();
    if(!q){ closeSuggest(); return; }
    const items = searchIndex.filter(it=>it.label.toLowerCase().includes(q));
    openSuggest(items);
  });

  suggest.addEventListener('click', (e)=>{
    const row = e.target.closest('.item');
    if(!row) return;
    location.hash = row.getAttribute('data-hash');
    closeSuggest();
    searchInput.blur();
  });

  searchInput.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){
      const q = searchInput.value.trim().toLowerCase();
      if(!q) return;
      const hit = searchIndex.find(it=>it.label.toLowerCase().includes(q));
      if(hit){
        location.hash = hit.hash;
        closeSuggest();
      }else{
        toast('未找到匹配结果', '试试更短的关键词，或使用“快速跳转（Ctrl K）”。');
      }
    }else if(e.key === 'Escape'){
      closeSuggest();
      searchInput.blur();
    }
  });

  document.addEventListener('click', (e)=>{
    if(!e.target.closest('.top-search')) closeSuggest();
  });

  // 路由
  const pages = $$('.page');
  const navLinks = $$('.top-nav a');

  function setActiveNav(hash){
    const route = (hash || '#home').replace('#','');
    navLinks.forEach(a=>{
      const nav = a.getAttribute('data-nav');
      a.classList.remove('active');
      if(!hash && nav==='home') a.classList.add('active');
      else if(route==='home' && nav==='home') a.classList.add('active');
      else if(route.startsWith('exhibition-detail') && nav==='exhibition') a.classList.add('active');
      else if(route.startsWith('city-') && nav==='city') a.classList.add('active');
      else if(route.startsWith('user-profile') && nav==='community') a.classList.add('active');
    });
  }

  function showPage(hash){
    if(!hash || hash==='#') hash = '#home';
    const id = hash.replace('#','');
    let found = false;
    pages.forEach(p=>{
      if(p.id === id){ p.classList.add('active'); found=true; }
      else p.classList.remove('active');
    });
    if(!found){
      pages.forEach(p=>{ if(p.id==='home') p.classList.add('active'); });
    }
    setActiveNav(hash);
    window.scrollTo({top:0, behavior:'instant'});
  }
  window.addEventListener('hashchange', ()=>showPage(location.hash));

  // Drawer / Modal / Cmdk 公共开关
  const overlay = $('#overlay');
  const drawer = $('#drawer');
  const modal = $('#modal');
  const cmdk = $('#cmdk');

  function openOverlay(){ overlay.classList.add('open'); overlay.setAttribute('aria-hidden','false'); }
  function closeOverlay(){ overlay.classList.remove('open'); overlay.setAttribute('aria-hidden','true'); }

  function openDrawer(){
    openOverlay();
    drawer.classList.add('open');
  }
  function closeDrawer(){
    drawer.classList.remove('open');
    closeOverlay();
  }
  function openModal(){
    openOverlay();
    modal.classList.add('open');
  }
  function closeModal(){
    modal.classList.remove('open');
    closeOverlay();
  }
  function openCmdk(){
    openOverlay();
    cmdk.classList.add('open');
    $('#cmdkInput').value = '';
    renderCmdk('');
    setTimeout(()=>$('#cmdkInput').focus(), 0);
  }
  function closeCmdk(){
    cmdk.classList.remove('open');
    closeOverlay();
  }

  $('#btnFilter').addEventListener('click', openDrawer);
  $('#closeDrawer').addEventListener('click', closeDrawer);
  $('#btnTheme').addEventListener('click', ()=>{
    state.theme = (state.theme==='dark') ? 'light' : 'dark';
    applyTheme();
    toast('主题已切换', state.theme==='dark' ? '已开启深色模式。' : '已开启浅色模式。');
  });

  overlay.addEventListener('click', ()=>{
    if(drawer.classList.contains('open')) closeDrawer();
    if(modal.classList.contains('open')) closeModal();
    if(cmdk.classList.contains('open')) closeCmdk();
  });

  document.addEventListener('keydown', (e)=>{
    const isMac = navigator.platform.toLowerCase().includes('mac');
    const ctrlk = (isMac ? e.metaKey : e.ctrlKey) && e.key.toLowerCase()==='k';
    if(ctrlk){
      e.preventDefault();
      if(cmdk.classList.contains('open')) closeCmdk();
      else openCmdk();
    }
    if(e.key === 'Escape'){
      closeSuggest();
      if(cmdk.classList.contains('open')) closeCmdk();
      if(modal.classList.contains('open')) closeModal();
      if(drawer.classList.contains('open')) closeDrawer();
    }
  });

  $('#btnCmdk').addEventListener('click', openCmdk);

  // Cmdk 渲染
  function renderCmdk(q){
    const list = $('#cmdkList');
    const query = (q||'').trim().toLowerCase();
    const items = !query
      ? searchIndex
      : searchIndex.filter(it=>it.label.toLowerCase().includes(query) || it.type.toLowerCase().includes(query));

    if(!items.length){
      list.innerHTML = `<div class="empty">没有匹配项，换个关键词试试。</div>`;
      return;
    }
    list.innerHTML = items.slice(0,16).map(it=>`
      <div class="row" tabindex="0" data-hash="${it.hash}">
        <div class="title">${it.label}</div>
        <div class="meta">${it.type}</div>
      </div>
    `).join('');
  }
  $('#cmdkInput').addEventListener('input', (e)=>renderCmdk(e.target.value));
  $('#cmdkList').addEventListener('click', (e)=>{
    const row = e.target.closest('.row');
    if(!row) return;
    location.hash = row.getAttribute('data-hash');
    closeCmdk();
  });

  // 筛选读写
  function syncFilterUI(){
    $('#fTypeMuseum').checked = !!state.filter.typeMuseum;
    $('#fTypeExh').checked = !!state.filter.typeExh;
    $('#minRating').value = state.filter.minRating;
    $('#minRatingText').textContent = state.filter.minRating.toFixed(1);
    $('#fFree').checked = !!state.filter.free;
    $('#fFamily').checked = !!state.filter.family;
    $('#fPhoto').checked = !!state.filter.photo;
    $('#fTags').value = (state.filter.tags || []).join(', ');
  }
  syncFilterUI();

  $('#minRating').addEventListener('input', (e)=>{
    $('#minRatingText').textContent = Number(e.target.value).toFixed(1);
  });

  $('#applyFilter').addEventListener('click', ()=>{
    state.filter = {
      typeMuseum: $('#fTypeMuseum').checked,
      typeExh: $('#fTypeExh').checked,
      minRating: Number($('#minRating').value),
      free: $('#fFree').checked,
      family: $('#fFamily').checked,
      photo: $('#fPhoto').checked,
      tags: $('#fTags').value.split(',').map(s=>s.trim()).filter(Boolean)
    };
    store.set('mx_filter', state.filter);
    closeDrawer();
    fakeLoading(renderHome);
    toast('筛选已应用', '首页列表已根据条件更新。');
    location.hash = '#home';
  });

  $('#resetFilter').addEventListener('click', ()=>{
    state.filter = { typeMuseum:true, typeExh:true, minRating:4.0, free:false, family:false, photo:false, tags:[] };
    store.set('mx_filter', state.filter);
    syncFilterUI();
    fakeLoading(renderHome);
    toast('已重置筛选', '已恢复默认条件。');
  });

  // 热门标签一键套用
  $('#hotTags').addEventListener('click', (e)=>{
    const b = e.target.closest('.badge');
    if(!b) return;
    const t = b.getAttribute('data-tag');
    state.filter.tags = [t];
    store.set('mx_filter', state.filter);
    syncFilterUI();
    fakeLoading(renderHome);
    toast('已按标签筛选', `当前标签：${t}`);
    location.hash = '#home';
  });

  // 全局按钮行为（收藏/想去/点赞/打卡/关注/写短评）
  function bump(el){
    el.classList.remove('pulse');
    void el.offsetWidth;
    el.classList.add('pulse');
  }

  document.addEventListener('click', (e)=>{
    const btn = e.target.closest('[data-action]');
    if(!btn) return;

    const action = btn.getAttribute('data-action');

    if(action === 'review'){
      const target = btn.getAttribute('data-target');
      state.reviewTarget = target;
      $('#modalSub').textContent = `对象：${target}`;
      $('#reviewText').value = '';
      $('#reviewScore').value = '4.5';
      $('#reviewScoreText').textContent = '4.5';
      openModal();
      return;
    }

    const id = btn.getAttribute('data-id');
    if(!id) return;

    const on = toggleAction(action, id);
    btn.classList.toggle('on', on);
    bump(btn);

    if(action==='fav') toast(on?'已收藏':'已取消收藏', id);
    if(action==='wish') toast(on?'已加入心愿':'已移出心愿', id);
    if(action==='like') toast(on?'已点赞':'已取消点赞', id);
    if(action==='checkin') toast(on?'已打卡':'已取消打卡', id);
    if(action==='follow') toast(on?'关注成功':'已取消关注', id);
  });

  // 评论弹窗
  $('#closeModal').addEventListener('click', closeModal);
  $('#cancelReview').addEventListener('click', closeModal);
  $('#reviewScore').addEventListener('input', (e)=>$('#reviewScoreText').textContent = Number(e.target.value).toFixed(1));
  $('#submitReview').addEventListener('click', ()=>{
    const text = $('#reviewText').value.trim();
    if(!text){
      toast('提交失败', '短评内容不能为空。');
      return;
    }
    toast('提交成功', `已为 ${state.reviewTarget} 提交短评（模拟）。`);
    closeModal();
  });

  // 回到顶部按钮
  const btnTop = $('#btnTop');
  window.addEventListener('scroll', ()=>{
    if(window.scrollY > 420) btnTop.classList.remove('hide');
    else btnTop.classList.add('hide');
  }, {passive:true});
  btnTop.addEventListener('click', ()=>window.scrollTo({top:0, behavior:'smooth'}));

  // reveal 动效
  let io = null;
  function observeReveal(){
    if(io) io.disconnect();
    io = new IntersectionObserver((entries)=>{
      entries.forEach(ent=>{
        if(ent.isIntersecting){
          ent.target.classList.add('in');
          io.unobserve(ent.target);
        }
      });
    }, {threshold:0.08});
    $$('.reveal').forEach(el=>{
      if(el.classList.contains('in')) return;
      io.observe(el);
    });
  }

  // 初始化
  fakeLoading(renderHome);
  showPage(location.hash || '#home');
  observeReveal();

})();
</script>
</body>
</html>
